<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Zillow Link Generator</title>
</head>
<body>
  <h1>Generate Zillow Link by GPS Coordinates</h1>

  <label for="latitude">Latitude:</label>
  <input id="latitude" type="text" value="31.927829">
  <br><br>

  <label for="longitude">Longitude:</label>
  <input id="longitude" type="text" value="-81.083683">
  <br><br>

  <button onclick="generateLink()">Generate Link</button>

  <p>
    <strong>Result:</strong> <br>
    <a id="zillowLink" href="#" target="_blank"></a>
  </p>

  <script>
    function generateLink() {
      // 1. Get user input
      const lat = parseFloat(document.getElementById('latitude').value);
      const lon = parseFloat(document.getElementById('longitude').value);

      // 2. Approx conversion: 1 degree of latitude ~ 69 miles
      const MILES_PER_LAT_DEGREE = 69.0;
      const oneMileInLatDegrees = 1.0 / MILES_PER_LAT_DEGREE;

      // 3. Calculate latitude offsets (± 1 mile)
      const latOffset = oneMileInLatDegrees;
      const latMax = lat + latOffset;
      const latMin = lat - latOffset;

      // 4. Calculate longitude offsets (± 1 mile, scaled by cos(lat))
      const latRadians = lat * Math.PI / 180.0;
      const lonOffset = oneMileInLatDegrees * Math.cos(latRadians);
      const lonMax = lon + lonOffset;
      const lonMin = lon - lonOffset;

      // 5. Construct Zillow’s searchQueryState JSON
      const searchQueryState = {
        isMapVisible: true,
        mapBounds: {
          west: lonMin,
          east: lonMax,
          south: latMin,
          north: latMax
        },
        filterState: {
          sort: { value: "globalrelevanceex" }
        },
        isListVisible: true,
        category: "cat1"
      };

      // 6. URL-encode the JSON for use in the query parameter
      const encodedSearchQuery = encodeURIComponent(JSON.stringify(searchQueryState));

      // 7. Construct the final Zillow URL
      const zillowUrl = `https://www.zillow.com/homes/for_sale/?searchQueryState=${encodedSearchQuery}&category=SEMANTIC`;

      // 8. Update the link in the page
      const linkElem = document.getElementById('zillowLink');
      linkElem.href = zillowUrl;
      linkElem.textContent = zillowUrl;
    }
  </script>
</body>
</html>
